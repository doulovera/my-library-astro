---
import Layout from '../../layouts/Layout.astro';
import AuthorInfo from '../../components/author-info/AuthorInfo';
import { searchBookByIsbn } from '../../services/book.service.ts';

export const prerender = false

const { url } = Astro
const bookId = url.pathname.split('/')[2]
const bookIsbn = bookId.split('-').at(-1)

const bookInfo = await searchBookByIsbn(bookIsbn as string)

const { success, author, cover, title, publishDate } = bookInfo

// if (!success)

const firstAuthor = author?.split(',').at(0)

---

<Layout title="Home">
  <div class="mt-10 grid gap-2 sm:grid-cols-[1fr,_0.5fr]">
    <section class="p-10 bg-gray-50 rounded-xl shadow-xl">    
      <div class="flex gap-5">
        <div>
          <img src={cover} alt="" transition:name={`book-cover-${bookId}`}>
        </div>
        <h2 class="text-xl mb-1 font-title">{title}</h2>
      </div>
    </section>
    <AuthorInfo client:visible authorName={firstAuthor} />
  </div>
</Layout>
